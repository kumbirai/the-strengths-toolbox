# P6.2.8 Core Web Vitals Testing Implementation Plan

## 1. Overview and Objectives

### 1.1 Purpose
This document provides detailed step-by-step instructions for testing and optimizing Core Web Vitals (LCP, FID, CLS) for The Strengths Toolbox website.

### 1.2 Scope
This implementation plan covers task P6.2.8:
- **P6.2.8**: Test Core Web Vitals
  - Measure Largest Contentful Paint (LCP)
  - Measure First Input Delay (FID)
  - Measure Cumulative Layout Shift (CLS)
  - Create testing tools
  - Document optimization strategies
  - Set up monitoring

### 1.3 Success Criteria
- LCP < 2.5 seconds
- FID < 100 milliseconds
- CLS < 0.1
- Testing tools created
- Monitoring set up
- Optimization strategies documented

## 2. Prerequisites

### 2.1 Required Knowledge
- Core Web Vitals metrics
- Performance optimization
- Google PageSpeed Insights
- Chrome DevTools

### 2.2 Dependencies
- All previous performance optimizations
- Production-like environment for testing

### 2.3 Reference Documents
- Performance Architecture: `documentation/01-architecture/07-performance-optimization-architecture.md`
- Google Core Web Vitals: https://web.dev/vitals/

## 3. Existing Implementation Review

### 3.1 Current State
- Performance optimizations implemented
- May need Core Web Vitals testing

### 3.2 What Needs to Be Done
- Create testing tools
- Measure Core Web Vitals
- Document optimization strategies
- Set up monitoring

## 4. Task P6.2.8: Test Core Web Vitals

### 4.1 Overview
Implement comprehensive testing and monitoring for Core Web Vitals to ensure optimal user experience.

### 4.2 Step-by-Step Implementation

#### Step 1: Create Core Web Vitals Testing Command

**File: `app/Console/Commands/TestCoreWebVitals.php`**

```php
<?php

namespace App\Console\Commands;

use Illuminate\Console\Command;
use Illuminate\Support\Facades\Http;

class TestCoreWebVitals extends Command
{
    protected $signature = 'performance:test-web-vitals {url?}';
    protected $description = 'Test Core Web Vitals using PageSpeed Insights API';

    public function handle(): int
    {
        $url = $this->argument('url') ?? config('app.url');
        
        $this->info("Testing Core Web Vitals for: {$url}");
        $this->newLine();

        // Note: Requires Google PageSpeed Insights API key
        $apiKey = config('services.google.pagespeed_api_key');
        
        if (!$apiKey) {
            $this->warn('Google PageSpeed Insights API key not configured.');
            $this->info('Set GOOGLE_PAGESPEED_API_KEY in .env');
            $this->info('Or test manually at: https://pagespeed.web.dev/');
            return 1;
        }

        try {
            $response = Http::get('https://www.googleapis.com/pagespeedonline/v5/runPagespeed', [
                'url' => $url,
                'key' => $apiKey,
                'category' => 'performance',
            ]);

            if (!$response->successful()) {
                $this->error('Failed to fetch PageSpeed data');
                return 1;
            }

            $data = $response->json();
            $this->displayResults($data);
            
            return 0;
        } catch (\Exception $e) {
            $this->error("Error: {$e->getMessage()}");
            return 1;
        }
    }

    protected function displayResults(array $data): void
    {
        $metrics = $data['lighthouseResult']['audits'] ?? [];
        
        // LCP
        $lcp = $metrics['largest-contentful-paint'] ?? null;
        if ($lcp) {
            $lcpValue = $lcp['numericValue'] / 1000; // Convert to seconds
            $status = $lcpValue < 2.5 ? '✓' : '✗';
            $this->line("{$status} LCP (Largest Contentful Paint): {$lcpValue}s (Target: < 2.5s)");
        }

        // FID
        $fid = $metrics['max-potential-fid'] ?? null;
        if ($fid) {
            $fidValue = $fid['numericValue'];
            $status = $fidValue < 100 ? '✓' : '✗';
            $this->line("{$status} FID (First Input Delay): {$fidValue}ms (Target: < 100ms)");
        }

        // CLS
        $cls = $metrics['cumulative-layout-shift'] ?? null;
        if ($cls) {
            $clsValue = $cls['numericValue'];
            $status = $clsValue < 0.1 ? '✓' : '✗';
            $this->line("{$status} CLS (Cumulative Layout Shift): {$clsValue} (Target: < 0.1)");
        }

        $this->newLine();
        $this->info('Full report: ' . ($data['lighthouseResult']['finalUrl'] ?? ''));
    }
}
```

#### Step 2: Add Google API Key Configuration

**File: `config/services.php`**

**Update required:**
```php
'google' => [
    'pagespeed_api_key' => env('GOOGLE_PAGESPEED_API_KEY'),
],
```

#### Step 3: Create Performance Testing Documentation

**File: `documentation/PERFORMANCE_TESTING.md`**

```markdown
# Performance Testing Guide

## Core Web Vitals Targets

- **LCP (Largest Contentful Paint):** < 2.5 seconds
- **FID (First Input Delay):** < 100 milliseconds
- **CLS (Cumulative Layout Shift):** < 0.1

## Testing Tools

### 1. Google PageSpeed Insights
- URL: https://pagespeed.web.dev/
- Enter your website URL
- Review Core Web Vitals scores

### 2. Chrome DevTools
- Open DevTools (F12)
- Go to Lighthouse tab
- Run Performance audit
- Review Core Web Vitals

### 3. Command Line Tool
```bash
php artisan performance:test-web-vitals
```

## Optimization Strategies

### LCP Optimization
1. Optimize hero images
2. Use WebP format
3. Set proper image dimensions
4. Minimize render-blocking resources
5. Use CDN for static assets

### FID Optimization
1. Minimize JavaScript execution
2. Code splitting
3. Defer non-critical scripts
4. Optimize event handlers

### CLS Optimization
1. Set image dimensions
2. Reserve space for ads/embeds
3. Use font-display: swap
4. Avoid inserting content above existing content
```

#### Step 4: Create Real User Monitoring (Optional)

**File: `resources/js/web-vitals.js`**

```javascript
// Real User Monitoring for Core Web Vitals
import {onCLS, onFID, onLCP} from 'web-vitals';

function sendToAnalytics(metric) {
    // Send to your analytics service
    if (typeof gtag !== 'undefined') {
        gtag('event', metric.name, {
            value: Math.round(metric.name === 'CLS' ? metric.value * 1000 : metric.value),
            event_category: 'Web Vitals',
            event_label: metric.id,
            non_interaction: true,
        });
    }
}

onCLS(sendToAnalytics);
onFID(sendToAnalytics);
onLCP(sendToAnalytics);
```

**Install web-vitals:**
```bash
npm install web-vitals
```

#### Step 5: Create Performance Monitoring Dashboard (Optional)

**File: `app/Http/Controllers/Admin/AdminPerformanceController.php`**

```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use Illuminate\Http\Request;

class AdminPerformanceController extends Controller
{
    public function index()
    {
        // Display performance metrics
        // Could integrate with analytics data
        return view('admin.performance.index');
    }
}
```

## 5. Testing Instructions

### 5.1 Manual Testing

1. **Google PageSpeed Insights:**
   - Visit https://pagespeed.web.dev/
   - Enter website URL
   - Review Core Web Vitals scores
   - Check optimization suggestions

2. **Chrome DevTools:**
   - Open DevTools
   - Lighthouse tab
   - Run Performance audit
   - Review metrics

### 5.2 Automated Testing

1. **Run command:**
   ```bash
   php artisan performance:test-web-vitals
   ```

2. **CI/CD Integration:**
   - Add to deployment pipeline
   - Fail build if metrics below threshold

## 6. Success Criteria Validation

- [ ] LCP < 2.5 seconds
- [ ] FID < 100 milliseconds
- [ ] CLS < 0.1
- [ ] Testing tools working
- [ ] Monitoring set up
- [ ] Optimization strategies documented

## 7. Notes and Considerations

1. **Testing Environment:**
   - Test in production-like environment
   - Use real network conditions
   - Test on mobile devices

2. **Continuous Monitoring:**
   - Set up regular testing
   - Monitor trends over time
   - Alert on degradation

3. **Optimization Priority:**
   - Focus on LCP first (biggest impact)
   - Then CLS (user experience)
   - Finally FID (interactivity)

---

**Document Version:** 1.0  
**Date Created:** 2025-01-27  
**Status:** Ready for Implementation
