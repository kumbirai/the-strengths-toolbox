# P3.2 Blog Management Implementation Plan

## 1. Overview and Objectives

### 1.1 Purpose
This document provides detailed step-by-step instructions for implementing the blog management system in the admin panel for The Strengths Toolbox website. This includes building admin interfaces for creating, editing, and managing blog posts with categories, tags, featured images, and scheduling capabilities.

### 1.2 Scope
This implementation plan covers tasks P3.2.1 through P3.2.7:
- **P3.2.1**: Build blog post list view
- **P3.2.2**: Build blog post create form
- **P3.2.3**: Build blog post edit form
- **P3.2.4**: Implement category management
- **P3.2.5**: Implement tag management
- **P3.2.6**: Add featured image upload
- **P3.2.7**: Implement post scheduling

### 1.3 Success Criteria
- Blog post list view displays all posts with filtering and search
- Create and edit forms functional with validation
- Category and tag management working
- Featured image upload and display working
- Post scheduling functionality implemented
- All operations properly integrated with existing services

## 2. Prerequisites

### 2.1 Required Knowledge
- Laravel Blade templating
- Form validation in Laravel
- JavaScript and Alpine.js
- Image upload handling
- Date/time handling for scheduling
- Many-to-many relationships

### 2.2 Dependencies
- Task P2.3.7 completed (AdminBlogController created)
- Task P2.1.2 completed (BlogPostService created)
- Task P2.2.2 completed (BlogPostRepository created)
- Task P1.2.3 completed (BlogPost, Category, Tag models created)
- Task P3.1.5 completed (WYSIWYG editor integration)
- Task P3.3 completed (Media library for image uploads)

### 2.3 Reference Documents
- Admin Panel Architecture: `documentation/01-architecture/09-admin-panel-architecture.md`
- Database Architecture: `documentation/01-architecture/03-database-architecture.md`
- Phase 3.1: `documentation/03-development/phase-03/P3.1-page-management.md`

## 3. Existing Implementation Review

### 3.1 Current State
The following components are already implemented:
- `AdminBlogController` with CRUD methods
- `BlogPostService` with business logic
- `BlogPostRepository` with data access methods
- `BlogPost`, `Category`, and `Tag` models with relationships
- Admin authentication and middleware

### 3.2 What Needs to Be Built
- Admin views for blog management (list, create, edit, show)
- Category management interface
- Tag management interface
- Featured image upload functionality
- Post scheduling UI and logic

## 4. Task P3.2.1: Build Blog Post List View

### 4.1 Overview
Create an admin interface to list all blog posts with search, filtering by category/author/status, and pagination.

### 4.2 Step-by-Step Implementation

#### Step 1: Create Blog Index View

**File: `resources/views/admin/blog/index.blade.php`**

```blade
@extends('layouts.admin')

@section('title', 'Blog Posts')

@section('content')
<div class="space-y-6">
    {{-- Header --}}
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">Blog Posts</h1>
            <p class="mt-1 text-sm text-gray-600">Manage your blog posts</p>
        </div>
        <div class="flex items-center gap-3">
            <a href="{{ route('admin.blog.categories.index') }}" class="btn btn-outline">
                Manage Categories
            </a>
            <a href="{{ route('admin.blog.tags.index') }}" class="btn btn-outline">
                Manage Tags
            </a>
            <a href="{{ route('admin.blog.create') }}" class="btn btn-primary">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Create New Post
            </a>
        </div>
    </div>

    {{-- Filters and Search --}}
    <div class="bg-white rounded-lg shadow p-6">
        <form method="GET" action="{{ route('admin.blog.index') }}" class="flex flex-wrap gap-4">
            <div class="flex-1 min-w-[200px]">
                <label for="search" class="form-label">Search</label>
                <input 
                    type="text" 
                    id="search" 
                    name="search" 
                    value="{{ request('search') }}"
                    placeholder="Search by title or content..."
                    class="form-input"
                >
            </div>
            
            <div class="w-48">
                <label for="is_published" class="form-label">Status</label>
                <select id="is_published" name="is_published" class="form-input">
                    <option value="">All</option>
                    <option value="1" {{ request('is_published') === '1' ? 'selected' : '' }}>Published</option>
                    <option value="0" {{ request('is_published') === '0' ? 'selected' : '' }}>Draft</option>
                </select>
            </div>

            <div class="w-48">
                <label for="category_id" class="form-label">Category</label>
                <select id="category_id" name="category_id" class="form-input">
                    <option value="">All Categories</option>
                    @foreach($categories as $category)
                        <option value="{{ $category->id }}" {{ request('category_id') == $category->id ? 'selected' : '' }}>
                            {{ $category->name }}
                        </option>
                    @endforeach
                </select>
            </div>
            
            <div class="flex items-end gap-2">
                <button type="submit" class="btn btn-primary">Filter</button>
                <a href="{{ route('admin.blog.index') }}" class="btn btn-outline">Clear</a>
            </div>
        </form>
    </div>

    {{-- Blog Posts Table --}}
    <div class="bg-white rounded-lg shadow overflow-hidden">
        @if($posts->count() > 0)
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Post
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Author
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Categories
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Status
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Published
                        </th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Actions
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    @foreach($posts as $post)
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                @if($post->featured_image)
                                <div class="flex-shrink-0 h-16 w-16">
                                    <img 
                                        class="h-16 w-16 rounded object-cover" 
                                        src="{{ asset('storage/' . $post->featured_image) }}" 
                                        alt="{{ $post->title }}"
                                    >
                                </div>
                                @endif
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900">
                                        {{ $post->title }}
                                    </div>
                                    @if($post->excerpt)
                                    <div class="text-sm text-gray-500 mt-1">
                                        {{ Str::limit($post->excerpt, 60) }}
                                    </div>
                                    @endif
                                    <div class="text-xs text-gray-400 mt-1">
                                        <code>/blog/{{ $post->slug }}</code>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-gray-900">{{ $post->author->name ?? 'N/A' }}</div>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex flex-wrap gap-1">
                                @foreach($post->categories as $category)
                                    <span class="badge badge-primary">{{ $category->name }}</span>
                                @endforeach
                                @if($post->categories->isEmpty())
                                    <span class="text-sm text-gray-400">No categories</span>
                                @endif
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            @if($post->is_published && $post->published_at <= now())
                                <span class="badge badge-success">Published</span>
                            @elseif($post->is_published && $post->published_at > now())
                                <span class="badge badge-primary">Scheduled</span>
                            @else
                                <span class="badge badge-danger">Draft</span>
                            @endif
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            @if($post->published_at)
                                {{ $post->published_at->format('M d, Y') }}
                                <div class="text-xs text-gray-400">
                                    {{ $post->published_at->format('g:i A') }}
                                </div>
                            @else
                                <span class="text-gray-400">Not scheduled</span>
                            @endif
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <div class="flex items-center justify-end gap-2">
                                <a 
                                    href="{{ route('admin.blog.show', $post->id) }}" 
                                    class="text-primary-600 hover:text-primary-900"
                                    title="View"
                                >
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                    </svg>
                                </a>
                                <a 
                                    href="{{ route('admin.blog.edit', $post->id) }}" 
                                    class="text-primary-600 hover:text-primary-900"
                                    title="Edit"
                                >
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                    </svg>
                                </a>
                                <button 
                                    type="button"
                                    onclick="confirmDelete({{ $post->id }}, '{{ addslashes($post->title) }}')"
                                    class="text-red-600 hover:text-red-900"
                                    title="Delete"
                                >
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                    @endforeach
                </tbody>
            </table>

            {{-- Pagination --}}
            <div class="bg-gray-50 px-6 py-4 border-t border-gray-200">
                {{ $posts->links() }}
            </div>
        @else
            <div class="p-12 text-center">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">No blog posts</h3>
                <p class="mt-1 text-sm text-gray-500">Get started by creating a new blog post.</p>
                <div class="mt-6">
                    <a href="{{ route('admin.blog.create') }}" class="btn btn-primary">
                        Create New Post
                    </a>
                </div>
            </div>
        @endif
    </div>
</div>

{{-- Delete Confirmation Modal --}}
<div id="deleteModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full">
                <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
            </div>
            <h3 class="text-lg font-medium text-gray-900 text-center mt-5">Delete Blog Post</h3>
            <div class="mt-2 px-7 py-3">
                <p class="text-sm text-gray-500 text-center">
                    Are you sure you want to delete "<span id="postTitle"></span>"? This action cannot be undone.
                </p>
            </div>
            <div class="flex items-center justify-end gap-3 px-4 py-3">
                <button 
                    type="button"
                    onclick="closeDeleteModal()"
                    class="btn btn-outline"
                >
                    Cancel
                </button>
                <form id="deleteForm" method="POST" class="inline">
                    @csrf
                    @method('DELETE')
                    <button type="submit" class="btn btn-primary bg-red-600 hover:bg-red-700">
                        Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

@push('scripts')
<script>
function confirmDelete(id, title) {
    document.getElementById('postTitle').textContent = title;
    document.getElementById('deleteForm').action = `/admin/blog/${id}`;
    document.getElementById('deleteModal').classList.remove('hidden');
}

function closeDeleteModal() {
    document.getElementById('deleteModal').classList.add('hidden');
}

document.getElementById('deleteModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeDeleteModal();
    }
});
</script>
@endpush
@endsection
```

### 4.3 Validation
- Visit `/admin/blog` and verify the list displays correctly
- Test search functionality
- Test filtering by status and category
- Verify pagination works
- Test delete confirmation modal

## 5. Task P3.2.2: Build Blog Post Create Form

### 5.1 Overview
Create a comprehensive form for creating new blog posts with all necessary fields including categories, tags, featured image, and scheduling.

### 5.2 Step-by-Step Implementation

#### Step 1: Create Blog Post Create View

**File: `resources/views/admin/blog/create.blade.php`**

```blade
@extends('layouts.admin')

@section('title', 'Create Blog Post')

@section('content')
<div class="max-w-6xl mx-auto">
    <div class="mb-6">
        <h1 class="text-2xl font-bold text-gray-900">Create New Blog Post</h1>
        <p class="mt-1 text-sm text-gray-600">Add a new blog post to your website</p>
    </div>

    <form method="POST" action="{{ route('admin.blog.store') }}" enctype="multipart/form-data" id="blogPostForm">
        @csrf

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            {{-- Main Content --}}
            <div class="lg:col-span-2 space-y-6">
                {{-- Basic Information --}}
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Basic Information</h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label for="title" class="form-label">Title <span class="text-red-500">*</span></label>
                            <input 
                                type="text" 
                                id="title" 
                                name="title" 
                                value="{{ old('title') }}"
                                required
                                class="form-input @error('title') border-red-500 @enderror"
                                placeholder="Enter blog post title"
                            >
                            @error('title')
                                <p class="form-error">{{ $message }}</p>
                            @enderror
                        </div>

                        <div>
                            <label for="slug" class="form-label">URL Slug</label>
                            <div class="flex items-center">
                                <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                    /blog/
                                </span>
                                <input 
                                    type="text" 
                                    id="slug" 
                                    name="slug" 
                                    value="{{ old('slug') }}"
                                    class="form-input rounded-l-none @error('slug') border-red-500 @enderror"
                                    placeholder="url-slug"
                                >
                            </div>
                            <p class="mt-1 text-sm text-gray-500">Leave empty to auto-generate from title</p>
                            @error('slug')
                                <p class="form-error">{{ $message }}</p>
                            @enderror
                        </div>

                        <div>
                            <label for="excerpt" class="form-label">Excerpt</label>
                            <textarea 
                                id="excerpt" 
                                name="excerpt" 
                                rows="3"
                                maxlength="500"
                                class="form-input @error('excerpt') border-red-500 @enderror"
                                placeholder="Brief summary of the blog post"
                            >{{ old('excerpt') }}</textarea>
                            <p class="mt-1 text-sm text-gray-500">
                                <span id="excerptCount">0</span>/500 characters
                            </p>
                            @error('excerpt')
                                <p class="form-error">{{ $message }}</p>
                            @enderror
                        </div>
                    </div>
                </div>

                {{-- Content --}}
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Content</h2>
                    <div>
                        <label for="content" class="form-label">Content <span class="text-red-500">*</span></label>
                        <textarea 
                            id="content" 
                            name="content" 
                            required
                            class="form-input @error('content') border-red-500 @enderror"
                            rows="20"
                        >{{ old('content') }}</textarea>
                        @error('content')
                            <p class="form-error">{{ $message }}</p>
                        @enderror
                    </div>
                </div>
            </div>

            {{-- Sidebar --}}
            <div class="space-y-6">
                {{-- Publishing Options --}}
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Publishing</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="author_id" class="form-label">Author <span class="text-red-500">*</span></label>
                            <select 
                                id="author_id" 
                                name="author_id" 
                                required
                                class="form-input @error('author_id') border-red-500 @enderror"
                            >
                                <option value="">Select author</option>
                                @foreach(\App\Models\User::whereIn('role', ['admin', 'editor', 'author'])->get() as $user)
                                    <option value="{{ $user->id }}" {{ old('author_id', auth()->id()) == $user->id ? 'selected' : '' }}>
                                        {{ $user->name }}
                                    </option>
                                @endforeach
                            </select>
                            @error('author_id')
                                <p class="form-error">{{ $message }}</p>
                            @enderror
                        </div>

                        <div>
                            <label for="published_at" class="form-label">Publish Date & Time</label>
                            <input 
                                type="datetime-local" 
                                id="published_at" 
                                name="published_at" 
                                value="{{ old('published_at', now()->format('Y-m-d\TH:i')) }}"
                                class="form-input @error('published_at') border-red-500 @enderror"
                            >
                            <p class="mt-1 text-sm text-gray-500">Schedule publication for a future date</p>
                            @error('published_at')
                                <p class="form-error">{{ $message }}</p>
                            @enderror
                        </div>

                        <div class="flex items-center">
                            <input 
                                type="checkbox" 
                                id="is_published" 
                                name="is_published" 
                                value="1"
                                {{ old('is_published') ? 'checked' : '' }}
                                class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"
                            >
                            <label for="is_published" class="ml-2 block text-sm text-gray-900">
                                Publish immediately
                            </label>
                        </div>
                    </div>
                </div>

                {{-- Featured Image --}}
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Featured Image</h2>
                    <div>
                        <label for="featured_image" class="form-label">Upload Image</label>
                        <input 
                            type="file" 
                            id="featured_image" 
                            name="featured_image" 
                            accept="image/*"
                            class="form-input @error('featured_image') border-red-500 @enderror"
                            onchange="previewImage(this)"
                        >
                        <p class="mt-1 text-sm text-gray-500">Recommended: 1200x630px (max 2MB)</p>
                        @error('featured_image')
                            <p class="form-error">{{ $message }}</p>
                        @enderror
                        
                        <div id="imagePreview" class="mt-4 hidden">
                            <img id="previewImg" src="" alt="Preview" class="w-full h-48 object-cover rounded-lg">
                        </div>
                    </div>
                </div>

                {{-- Categories --}}
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Categories</h2>
                    <div class="space-y-2 max-h-64 overflow-y-auto">
                        @foreach($categories as $category)
                        <div class="flex items-center">
                            <input 
                                type="checkbox" 
                                id="category_{{ $category->id }}" 
                                name="category_ids[]" 
                                value="{{ $category->id }}"
                                {{ in_array($category->id, old('category_ids', [])) ? 'checked' : '' }}
                                class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"
                            >
                            <label for="category_{{ $category->id }}" class="ml-2 block text-sm text-gray-900">
                                {{ $category->name }}
                            </label>
                        </div>
                        @endforeach
                        @if($categories->isEmpty())
                            <p class="text-sm text-gray-500">No categories available. <a href="{{ route('admin.blog.categories.create') }}" class="text-primary-600">Create one</a></p>
                        @endif
                    </div>
                </div>

                {{-- Tags --}}
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Tags</h2>
                    <div class="space-y-2 max-h-64 overflow-y-auto">
                        @foreach($tags as $tag)
                        <div class="flex items-center">
                            <input 
                                type="checkbox" 
                                id="tag_{{ $tag->id }}" 
                                name="tag_ids[]" 
                                value="{{ $tag->id }}"
                                {{ in_array($tag->id, old('tag_ids', [])) ? 'checked' : '' }}
                                class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"
                            >
                            <label for="tag_{{ $tag->id }}" class="ml-2 block text-sm text-gray-900">
                                {{ $tag->name }}
                            </label>
                        </div>
                        @endforeach
                        @if($tags->isEmpty())
                            <p class="text-sm text-gray-500">No tags available. <a href="{{ route('admin.blog.tags.create') }}" class="text-primary-600">Create one</a></p>
                        @endif
                    </div>
                </div>
            </div>
        </div>

        {{-- Form Actions --}}
        <div class="mt-6 flex items-center justify-end gap-3">
            <a href="{{ route('admin.blog.index') }}" class="btn btn-outline">
                Cancel
            </a>
            <button type="submit" class="btn btn-primary">
                Create Post
            </button>
        </div>
    </form>
</div>

@push('styles')
<link rel="stylesheet" href="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.css" referrerpolicy="origin">
@endpush

@push('scripts')
<script src="https://cdn.tiny.cloud/1/{{ config('services.tinymce.api_key') }}/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
<script>
// Auto-generate slug from title
document.getElementById('title').addEventListener('input', function() {
    const slugInput = document.getElementById('slug');
    if (!slugInput.value || slugInput.dataset.autoGenerated === 'true') {
        slugInput.value = this.value.toLowerCase()
            .replace(/[^a-z0-9]+/g, '-')
            .replace(/^-+|-+$/g, '');
        slugInput.dataset.autoGenerated = 'true';
    }
});

document.getElementById('slug').addEventListener('input', function() {
    this.dataset.autoGenerated = 'false';
});

// Character counter for excerpt
document.getElementById('excerpt').addEventListener('input', function() {
    document.getElementById('excerptCount').textContent = this.value.length;
});

// Image preview
function previewImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('previewImg').src = e.target.result;
            document.getElementById('imagePreview').classList.remove('hidden');
        };
        reader.readAsDataURL(input.files[0]);
    }
}

// Initialize TinyMCE
tinymce.init({
    selector: '#content',
    height: 600,
    menubar: false,
    plugins: [
        'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
        'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',
        'insertdatetime', 'media', 'table', 'code', 'help', 'wordcount'
    ],
    toolbar: 'undo redo | formatselect | ' +
        'bold italic backcolor | alignleft aligncenter ' +
        'alignright alignjustify | bullist numlist outdent indent | ' +
        'removeformat | link image | code | help',
    content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }',
    branding: false,
    promotion: false,
    file_picker_types: 'image',
    images_upload_url: '{{ route("admin.media.upload") }}',
    automatic_uploads: true,
    setup: function(editor) {
        editor.on('change', function() {
            editor.save();
        });
    }
});
</script>
@endpush
@endsection
```

### 5.3 Validation
- Visit `/admin/blog/create` and verify form displays
- Test all form fields
- Test image upload preview
- Test category and tag selection
- Verify form validation

## 6. Task P3.2.3: Build Blog Post Edit Form

### 6.1 Overview
Create an edit form similar to the create form but pre-populated with existing post data.

### 6.2 Step-by-Step Implementation

#### Step 1: Create Blog Post Edit View

**File: `resources/views/admin/blog/edit.blade.php`**

This view is similar to the create view but with pre-populated data. Key differences:
- Form action points to `update` route
- Form method is `PUT`
- All fields have `old()` fallback to `$post->field`
- Categories and tags are pre-selected
- Featured image preview shows existing image if available

The structure is identical to `create.blade.php` but with these modifications:

```blade
<form method="POST" action="{{ route('admin.blog.update', $post->id) }}" enctype="multipart/form-data" id="blogPostForm">
    @csrf
    @method('PUT')
    
    {{-- All fields use: value="{{ old('field', $post->field) }}" --}}
    
    {{-- Categories pre-selected --}}
    @foreach($categories as $category)
    <input 
        type="checkbox" 
        id="category_{{ $category->id }}" 
        name="category_ids[]" 
        value="{{ $category->id }}"
        {{ in_array($category->id, old('category_ids', $post->categories->pluck('id')->toArray())) ? 'checked' : '' }}
    >
    @endforeach
    
    {{-- Featured image preview --}}
    @if($post->featured_image)
    <div class="mt-4">
        <p class="text-sm text-gray-600 mb-2">Current image:</p>
        <img src="{{ asset('storage/' . $post->featured_image) }}" alt="Current featured image" class="w-full h-48 object-cover rounded-lg">
    </div>
    @endif
</form>
```

### 6.3 Validation
- Visit `/admin/blog/{id}/edit` and verify form is pre-populated
- Test updating post data
- Verify validation works
- Test image replacement

## 7. Task P3.2.4: Implement Category Management

### 7.1 Overview
Create admin interfaces for managing blog post categories (CRUD operations).

### 7.2 Step-by-Step Implementation

#### Step 1: Create Category Controller

**File: `app/Http/Controllers/Admin/AdminCategoryController.php`**

```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Category;
use Illuminate\Http\Request;
use Illuminate\Support\Str;

class AdminCategoryController extends Controller
{
    public function index()
    {
        $categories = Category::withCount('blogPosts')->latest()->paginate(20);
        return view('admin.blog.categories.index', compact('categories'));
    }

    public function create()
    {
        return view('admin.blog.categories.create');
    }

    public function store(Request $request)
    {
        $validated = $request->validate([
            'name' => 'required|string|max:255|unique:categories,name',
            'slug' => 'nullable|string|max:255|unique:categories,slug',
            'description' => 'nullable|string|max:1000',
        ]);

        if (empty($validated['slug'])) {
            $validated['slug'] = Str::slug($validated['name']);
        }

        Category::create($validated);

        return redirect()->route('admin.blog.categories.index')
            ->with('success', 'Category created successfully.');
    }

    public function edit(Category $category)
    {
        return view('admin.blog.categories.edit', compact('category'));
    }

    public function update(Request $request, Category $category)
    {
        $validated = $request->validate([
            'name' => 'required|string|max:255|unique:categories,name,' . $category->id,
            'slug' => 'nullable|string|max:255|unique:categories,slug,' . $category->id,
            'description' => 'nullable|string|max:1000',
        ]);

        if (empty($validated['slug'])) {
            $validated['slug'] = Str::slug($validated['name']);
        }

        $category->update($validated);

        return redirect()->route('admin.blog.categories.index')
            ->with('success', 'Category updated successfully.');
    }

    public function destroy(Category $category)
    {
        if ($category->blogPosts()->count() > 0) {
            return redirect()->back()
                ->withErrors(['error' => 'Cannot delete category with associated blog posts.']);
        }

        $category->delete();

        return redirect()->route('admin.blog.categories.index')
            ->with('success', 'Category deleted successfully.');
    }
}
```

#### Step 2: Add Category Routes

**File: `routes/admin.php`** (add)

```php
Route::prefix('blog')->name('blog.')->group(function () {
    Route::resource('categories', AdminCategoryController::class);
    Route::resource('tags', AdminTagController::class);
});
```

#### Step 3: Create Category Views

**File: `resources/views/admin/blog/categories/index.blade.php`**

```blade
@extends('layouts.admin')

@section('title', 'Categories')

@section('content')
<div class="space-y-6">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">Categories</h1>
            <p class="mt-1 text-sm text-gray-600">Manage blog post categories</p>
        </div>
        <a href="{{ route('admin.blog.categories.create') }}" class="btn btn-primary">
            Create Category
        </a>
    </div>

    <div class="bg-white rounded-lg shadow overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Slug</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Posts</th>
                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                @foreach($categories as $category)
                <tr>
                    <td class="px-6 py-4">{{ $category->name }}</td>
                    <td class="px-6 py-4"><code class="text-xs">{{ $category->slug }}</code></td>
                    <td class="px-6 py-4">{{ $category->blog_posts_count }}</td>
                    <td class="px-6 py-4 text-right">
                        <a href="{{ route('admin.blog.categories.edit', $category) }}" class="text-primary-600">Edit</a>
                        <form method="POST" action="{{ route('admin.blog.categories.destroy', $category) }}" class="inline">
                            @csrf
                            @method('DELETE')
                            <button type="submit" class="text-red-600 ml-4" onclick="return confirm('Are you sure?')">Delete</button>
                        </form>
                    </td>
                </tr>
                @endforeach
            </tbody>
        </table>
    </div>
</div>
@endsection
```

Create similar views for `create.blade.php` and `edit.blade.php` following the same pattern as page management forms.

### 7.3 Validation
- Test category CRUD operations
- Verify slug auto-generation
- Test category deletion prevention when posts exist

## 8. Task P3.2.5: Implement Tag Management

### 8.1 Overview
Create admin interfaces for managing blog post tags (CRUD operations).

### 8.2 Step-by-Step Implementation

#### Step 1: Create Tag Controller

**File: `app/Http/Controllers/Admin/AdminTagController.php`**

Similar structure to `AdminCategoryController` but simpler (no description field):

```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Tag;
use Illuminate\Http\Request;
use Illuminate\Support\Str;

class AdminTagController extends Controller
{
    public function index()
    {
        $tags = Tag::withCount('blogPosts')->latest()->paginate(20);
        return view('admin.blog.tags.index', compact('tags'));
    }

    public function create()
    {
        return view('admin.blog.tags.create');
    }

    public function store(Request $request)
    {
        $validated = $request->validate([
            'name' => 'required|string|max:255|unique:tags,name',
        ]);

        Tag::create([
            'name' => $validated['name'],
            'slug' => Str::slug($validated['name']),
        ]);

        return redirect()->route('admin.blog.tags.index')
            ->with('success', 'Tag created successfully.');
    }

    public function edit(Tag $tag)
    {
        return view('admin.blog.tags.edit', compact('tag'));
    }

    public function update(Request $request, Tag $tag)
    {
        $validated = $request->validate([
            'name' => 'required|string|max:255|unique:tags,name,' . $tag->id,
        ]);

        $tag->update([
            'name' => $validated['name'],
            'slug' => Str::slug($validated['name']),
        ]);

        return redirect()->route('admin.blog.tags.index')
            ->with('success', 'Tag updated successfully.');
    }

    public function destroy(Tag $tag)
    {
        $tag->delete();

        return redirect()->route('admin.blog.tags.index')
            ->with('success', 'Tag deleted successfully.');
    }
}
```

Create corresponding views similar to category views.

### 8.3 Validation
- Test tag CRUD operations
- Verify slug auto-generation
- Test tag assignment to posts

## 9. Task P3.2.6: Add Featured Image Upload

### 9.1 Overview
Implement featured image upload functionality for blog posts. This integrates with the media library (P3.3) but can be implemented with basic file upload first.

### 9.2 Step-by-Step Implementation

#### Step 1: Update BlogPostService to Handle Image Upload

**File: `app/Services/BlogPostService.php`** (add method)

```php
/**
 * Handle featured image upload
 *
 * @param \Illuminate\Http\UploadedFile $file
 * @return string
 */
protected function handleImageUpload($file): string
{
    $path = $file->store('blog/featured-images', 'public');
    
    // Optional: Resize image using Intervention Image
    // $image = Image::make(storage_path('app/public/' . $path));
    // $image->fit(1200, 630)->save();
    
    return $path;
}
```

Update `create` and `update` methods to handle image upload:

```php
public function create(array $data): BlogPost
{
    if (isset($data['featured_image']) && $data['featured_image']->isValid()) {
        $data['featured_image'] = $this->handleImageUpload($data['featured_image']);
    }

    // ... rest of create logic
}

public function update(int $id, array $data): BlogPost
{
    if (isset($data['featured_image']) && $data['featured_image']->isValid()) {
        // Delete old image if exists
        $post = $this->blogPostRepository->findById($id);
        if ($post && $post->featured_image) {
            Storage::disk('public')->delete($post->featured_image);
        }
        
        $data['featured_image'] = $this->handleImageUpload($data['featured_image']);
    }

    // ... rest of update logic
}
```

### 9.3 Validation
- Test image upload in create form
- Test image replacement in edit form
- Verify image displays in list and detail views
- Test image deletion when post is deleted

## 10. Task P3.2.7: Implement Post Scheduling

### 10.1 Overview
Add functionality to schedule blog posts for future publication.

### 10.2 Step-by-Step Implementation

#### Step 1: Update BlogPostService

The service should already handle `published_at` field. Verify the `scopePublished` in the BlogPost model checks both `is_published` and `published_at <= now()`.

#### Step 2: Add Scheduling Logic

**File: `app/Services/BlogPostService.php`** (update create/update methods)

```php
public function create(array $data): BlogPost
{
    // Handle scheduling
    if (isset($data['published_at']) && $data['published_at']) {
        $publishedAt = \Carbon\Carbon::parse($data['published_at']);
        
        // If published_at is in the future and is_published is true, 
        // the post will be scheduled
        if ($publishedAt->isFuture() && isset($data['is_published']) && $data['is_published']) {
            // Post is scheduled
        } elseif ($publishedAt->isPast() && isset($data['is_published']) && $data['is_published']) {
            // Post should be published immediately
            $data['published_at'] = now();
        }
    } else {
        // If no published_at set but is_published is true, set to now
        if (isset($data['is_published']) && $data['is_published']) {
            $data['published_at'] = now();
        }
    }

    // ... rest of create logic
}
```

#### Step 3: Add Scheduled Posts Indicator

In the blog index view, show scheduled posts with a badge (already implemented in P3.2.1).

### 10.3 Validation
- Create a post scheduled for future date
- Verify it shows as "Scheduled" in list
- Verify it doesn't appear on frontend until published_at
- Test immediate publication
- Test draft posts

## 11. Testing and Validation

### 11.1 Complete Workflow Test

1. **Create Blog Post:**
   - Navigate to `/admin/blog/create`
   - Fill in all fields
   - Upload featured image
   - Select categories and tags
   - Schedule for future date
   - Submit form
   - Verify post appears in list

2. **Edit Blog Post:**
   - Click edit on a post
   - Modify content
   - Change categories/tags
   - Replace featured image
   - Update schedule
   - Save changes

3. **Manage Categories:**
   - Create new category
   - Edit category
   - Assign to posts
   - Try to delete category with posts (should fail)

4. **Manage Tags:**
   - Create new tags
   - Assign to posts
   - Delete unused tags

### 11.2 Common Issues and Solutions

#### Issue: Featured image not uploading
**Solution:**
- Verify `enctype="multipart/form-data"` in form
- Check file permissions on storage directory
- Verify max file size in PHP config
- Check validation rules

#### Issue: Categories/tags not saving
**Solution:**
- Verify many-to-many relationships are set up
- Check pivot table exists
- Ensure `sync()` or `attach()` is called in service
- Verify form field names match

#### Issue: Scheduling not working
**Solution:**
- Verify `published_at` field is being saved
- Check `scopePublished` in model
- Ensure frontend queries use the scope
- Verify timezone settings

## 12. References

### 12.1 Architecture Documents
- Admin Panel Architecture: `documentation/01-architecture/09-admin-panel-architecture.md`
- Database Architecture: `documentation/01-architecture/03-database-architecture.md`

### 12.2 External Resources
- [Laravel File Storage](https://laravel.com/docs/10.x/filesystem)
- [Laravel Many-to-Many Relationships](https://laravel.com/docs/10.x/eloquent-relationships#many-to-many)

### 12.3 Related Tasks
- **Previous Task**: P3.1 - Page Management
- **Next Task**: P3.3 - Media Library
- **Dependencies**: P2.3.7, P2.1.2, P2.2.2

---

**Document Version**: 1.0  
**Last Updated**: 2025  
**Status**: Ready for Implementation
