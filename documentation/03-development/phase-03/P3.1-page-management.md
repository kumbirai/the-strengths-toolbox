# P3.1 Page Management Implementation Plan

## 1. Overview and Objectives

### 1.1 Purpose
This document provides detailed step-by-step instructions for implementing the page management system in the admin panel for The Strengths Toolbox website. This includes building admin interfaces for creating, editing, deleting, and previewing pages with a WYSIWYG editor.

### 1.2 Scope
This implementation plan covers tasks P3.1.1 through P3.1.6:
- **P3.1.1**: Build page list view (admin)
- **P3.1.2**: Build page create form
- **P3.1.3**: Build page edit form
- **P3.1.4**: Implement page deletion
- **P3.1.5**: Add WYSIWYG editor
- **P3.1.6**: Implement page preview

### 1.3 Success Criteria
- Page list view displays all pages with filtering and search
- Create and edit forms functional with validation
- WYSIWYG editor integrated and working
- Page deletion with confirmation
- Page preview functionality working
- All operations properly integrated with existing services and repositories

## 2. Prerequisites

### 2.1 Required Knowledge
- Laravel Blade templating
- Form validation in Laravel
- JavaScript and Alpine.js
- WYSIWYG editor integration (TinyMCE or similar)
- Tailwind CSS for styling

### 2.2 Dependencies
- Task P2.3.6 completed (AdminPageController created)
- Task P2.1.1 completed (PageService created)
- Task P2.2.1 completed (PageRepository created)
- Task P1.2.3 completed (Page model created)
- Task P2.5.2 completed (Admin layout created)
- Task P1.4.3 completed (Admin authentication)

### 2.3 Reference Documents
- Admin Panel Architecture: `documentation/01-architecture/09-admin-panel-architecture.md`
- Laravel MVC Architecture: `documentation/01-architecture/02-laravel-mvc-architecture.md`
- Frontend Architecture: `documentation/01-architecture/04-frontend-architecture.md`
- Phase 2 Controllers: `documentation/03-development/phase-02/P2.3-controllers.md`

## 3. Existing Implementation Review

### 3.1 Current State
The following components are already implemented:
- `AdminPageController` with CRUD methods (index, create, store, show, edit, update, destroy)
- `PageService` with business logic for page operations
- `PageRepository` with data access methods
- `Page` model with relationships and scopes
- Admin authentication and middleware

### 3.2 What Needs to Be Built
- Admin views for page management (list, create, edit, show)
- WYSIWYG editor integration
- Page preview functionality
- Enhanced deletion with confirmation
- Search and filtering UI

## 4. Task P3.1.1: Build Page List View (Admin)

### 4.1 Overview
Create an admin interface to list all pages with search, filtering, and pagination capabilities.

### 4.2 Step-by-Step Implementation

#### Step 1: Create Page Index View

**File: `resources/views/admin/pages/index.blade.php`**

```blade
@extends('layouts.admin')

@section('title', 'Pages')

@section('content')
<div class="space-y-6">
    {{-- Header --}}
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">Pages</h1>
            <p class="mt-1 text-sm text-gray-600">Manage your website pages</p>
        </div>
        <a href="{{ route('admin.pages.create') }}" class="btn btn-primary">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Create New Page
        </a>
    </div>

    {{-- Filters and Search --}}
    <div class="bg-white rounded-lg shadow p-6">
        <form method="GET" action="{{ route('admin.pages.index') }}" class="flex flex-wrap gap-4">
            <div class="flex-1 min-w-[200px]">
                <label for="search" class="form-label">Search</label>
                <input 
                    type="text" 
                    id="search" 
                    name="search" 
                    value="{{ request('search') }}"
                    placeholder="Search by title or slug..."
                    class="form-input"
                >
            </div>
            
            <div class="w-48">
                <label for="is_published" class="form-label">Status</label>
                <select id="is_published" name="is_published" class="form-input">
                    <option value="">All</option>
                    <option value="1" {{ request('is_published') === '1' ? 'selected' : '' }}>Published</option>
                    <option value="0" {{ request('is_published') === '0' ? 'selected' : '' }}>Draft</option>
                </select>
            </div>
            
            <div class="flex items-end gap-2">
                <button type="submit" class="btn btn-primary">Filter</button>
                <a href="{{ route('admin.pages.index') }}" class="btn btn-outline">Clear</a>
            </div>
        </form>
    </div>

    {{-- Pages Table --}}
    <div class="bg-white rounded-lg shadow overflow-hidden">
        @if($pages->count() > 0)
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Title
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Slug
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Status
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Updated
                        </th>
                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Actions
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    @foreach($pages as $page)
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">
                                {{ $page->title }}
                            </div>
                            @if($page->excerpt)
                            <div class="text-sm text-gray-500 mt-1">
                                {{ Str::limit($page->excerpt, 60) }}
                            </div>
                            @endif
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <code class="text-xs text-gray-600 bg-gray-100 px-2 py-1 rounded">
                                /{{ $page->slug }}
                            </code>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            @if($page->is_published)
                                <span class="badge badge-success">Published</span>
                            @else
                                <span class="badge badge-danger">Draft</span>
                            @endif
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ $page->updated_at->format('M d, Y') }}
                            <div class="text-xs text-gray-400">
                                {{ $page->updated_at->diffForHumans() }}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <div class="flex items-center justify-end gap-2">
                                <a 
                                    href="{{ route('admin.pages.show', $page->id) }}" 
                                    class="text-primary-600 hover:text-primary-900"
                                    title="View"
                                >
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                    </svg>
                                </a>
                                <a 
                                    href="{{ route('admin.pages.edit', $page->id) }}" 
                                    class="text-primary-600 hover:text-primary-900"
                                    title="Edit"
                                >
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                    </svg>
                                </a>
                                <button 
                                    type="button"
                                    onclick="confirmDelete({{ $page->id }}, '{{ addslashes($page->title) }}')"
                                    class="text-red-600 hover:text-red-900"
                                    title="Delete"
                                >
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                    @endforeach
                </tbody>
            </table>

            {{-- Pagination --}}
            <div class="bg-gray-50 px-6 py-4 border-t border-gray-200">
                {{ $pages->links() }}
            </div>
        @else
            <div class="p-12 text-center">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                <h3 class="mt-2 text-sm font-medium text-gray-900">No pages</h3>
                <p class="mt-1 text-sm text-gray-500">Get started by creating a new page.</p>
                <div class="mt-6">
                    <a href="{{ route('admin.pages.create') }}" class="btn btn-primary">
                        Create New Page
                    </a>
                </div>
            </div>
        @endif
    </div>
</div>

{{-- Delete Confirmation Modal --}}
<div id="deleteModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full">
                <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
            </div>
            <h3 class="text-lg font-medium text-gray-900 text-center mt-5">Delete Page</h3>
            <div class="mt-2 px-7 py-3">
                <p class="text-sm text-gray-500 text-center">
                    Are you sure you want to delete "<span id="pageTitle"></span>"? This action cannot be undone.
                </p>
            </div>
            <div class="flex items-center justify-end gap-3 px-4 py-3">
                <button 
                    type="button"
                    onclick="closeDeleteModal()"
                    class="btn btn-outline"
                >
                    Cancel
                </button>
                <form id="deleteForm" method="POST" class="inline">
                    @csrf
                    @method('DELETE')
                    <button type="submit" class="btn btn-primary bg-red-600 hover:bg-red-700">
                        Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

@push('scripts')
<script>
function confirmDelete(id, title) {
    document.getElementById('pageTitle').textContent = title;
    document.getElementById('deleteForm').action = `/admin/pages/${id}`;
    document.getElementById('deleteModal').classList.remove('hidden');
}

function closeDeleteModal() {
    document.getElementById('deleteModal').classList.add('hidden');
}

// Close modal when clicking outside
document.getElementById('deleteModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeDeleteModal();
    }
});
</script>
@endpush
@endsection
```

### 4.3 Validation
- Visit `/admin/pages` and verify the list displays correctly
- Test search functionality
- Test filtering by status
- Verify pagination works
- Test delete confirmation modal

## 5. Task P3.1.2: Build Page Create Form

### 5.1 Overview
Create a comprehensive form for creating new pages with all necessary fields and WYSIWYG editor.

### 5.2 Step-by-Step Implementation

#### Step 1: Create Page Create View

**File: `resources/views/admin/pages/create.blade.php`**

```blade
@extends('layouts.admin')

@section('title', 'Create Page')

@section('content')
<div class="max-w-4xl mx-auto">
    <div class="mb-6">
        <h1 class="text-2xl font-bold text-gray-900">Create New Page</h1>
        <p class="mt-1 text-sm text-gray-600">Add a new page to your website</p>
    </div>

    <form method="POST" action="{{ route('admin.pages.store') }}" id="pageForm">
        @csrf

        <div class="bg-white rounded-lg shadow space-y-6 p-6">
            {{-- Basic Information --}}
            <div>
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Basic Information</h2>
                
                <div class="space-y-4">
                    <div>
                        <label for="title" class="form-label">Title <span class="text-red-500">*</span></label>
                        <input 
                            type="text" 
                            id="title" 
                            name="title" 
                            value="{{ old('title') }}"
                            required
                            class="form-input @error('title') border-red-500 @enderror"
                            placeholder="Enter page title"
                        >
                        @error('title')
                            <p class="form-error">{{ $message }}</p>
                        @enderror
                    </div>

                    <div>
                        <label for="slug" class="form-label">URL Slug</label>
                        <div class="flex items-center">
                            <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                /
                            </span>
                            <input 
                                type="text" 
                                id="slug" 
                                name="slug" 
                                value="{{ old('slug') }}"
                                class="form-input rounded-l-none @error('slug') border-red-500 @enderror"
                                placeholder="url-slug"
                            >
                        </div>
                        <p class="mt-1 text-sm text-gray-500">Leave empty to auto-generate from title</p>
                        @error('slug')
                            <p class="form-error">{{ $message }}</p>
                        @enderror
                    </div>

                    <div>
                        <label for="excerpt" class="form-label">Excerpt</label>
                        <textarea 
                            id="excerpt" 
                            name="excerpt" 
                            rows="3"
                            class="form-input @error('excerpt') border-red-500 @enderror"
                            placeholder="Brief description of the page"
                        >{{ old('excerpt') }}</textarea>
                        <p class="mt-1 text-sm text-gray-500">A short summary of the page content</p>
                        @error('excerpt')
                            <p class="form-error">{{ $message }}</p>
                        @enderror
                    </div>
                </div>
            </div>

            {{-- Content --}}
            <div>
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Content</h2>
                <div>
                    <label for="content" class="form-label">Content <span class="text-red-500">*</span></label>
                    <textarea 
                        id="content" 
                        name="content" 
                        required
                        class="form-input @error('content') border-red-500 @enderror"
                        rows="15"
                    >{{ old('content') }}</textarea>
                    @error('content')
                        <p class="form-error">{{ $message }}</p>
                    @enderror
                </div>
            </div>

            {{-- SEO Settings --}}
            <div>
                <h2 class="text-lg font-semibold text-gray-900 mb-4">SEO Settings</h2>
                <div class="space-y-4">
                    <div>
                        <label for="meta_title" class="form-label">Meta Title</label>
                        <input 
                            type="text" 
                            id="meta_title" 
                            name="meta_title" 
                            value="{{ old('meta_title') }}"
                            maxlength="255"
                            class="form-input @error('meta_title') border-red-500 @enderror"
                            placeholder="SEO title (recommended: 50-60 characters)"
                        >
                        <p class="mt-1 text-sm text-gray-500">
                            <span id="metaTitleCount">0</span>/255 characters
                        </p>
                        @error('meta_title')
                            <p class="form-error">{{ $message }}</p>
                        @enderror
                    </div>

                    <div>
                        <label for="meta_description" class="form-label">Meta Description</label>
                        <textarea 
                            id="meta_description" 
                            name="meta_description" 
                            rows="3"
                            maxlength="500"
                            class="form-input @error('meta_description') border-red-500 @enderror"
                            placeholder="SEO description (recommended: 150-160 characters)"
                        >{{ old('meta_description') }}</textarea>
                        <p class="mt-1 text-sm text-gray-500">
                            <span id="metaDescCount">0</span>/500 characters
                        </p>
                        @error('meta_description')
                            <p class="form-error">{{ $message }}</p>
                        @enderror
                    </div>

                    <div>
                        <label for="meta_keywords" class="form-label">Meta Keywords</label>
                        <input 
                            type="text" 
                            id="meta_keywords" 
                            name="meta_keywords" 
                            value="{{ old('meta_keywords') }}"
                            class="form-input @error('meta_keywords') border-red-500 @enderror"
                            placeholder="keyword1, keyword2, keyword3"
                        >
                        <p class="mt-1 text-sm text-gray-500">Comma-separated keywords</p>
                        @error('meta_keywords')
                            <p class="form-error">{{ $message }}</p>
                        @enderror
                    </div>
                </div>
            </div>

            {{-- Publishing Options --}}
            <div>
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Publishing Options</h2>
                <div class="space-y-4">
                    <div class="flex items-center">
                        <input 
                            type="checkbox" 
                            id="is_published" 
                            name="is_published" 
                            value="1"
                            {{ old('is_published') ? 'checked' : '' }}
                            class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"
                        >
                        <label for="is_published" class="ml-2 block text-sm text-gray-900">
                            Publish this page
                        </label>
                    </div>
                </div>
            </div>
        </div>

        {{-- Form Actions --}}
        <div class="mt-6 flex items-center justify-end gap-3">
            <a href="{{ route('admin.pages.index') }}" class="btn btn-outline">
                Cancel
            </a>
            <button type="submit" class="btn btn-primary">
                Create Page
            </button>
        </div>
    </form>
</div>

@push('styles')
<link rel="stylesheet" href="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.css" referrerpolicy="origin">
@endpush

@push('scripts')
<script src="https://cdn.tiny.cloud/1/YOUR_API_KEY/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
<script>
// Auto-generate slug from title
document.getElementById('title').addEventListener('input', function() {
    const slugInput = document.getElementById('slug');
    if (!slugInput.value || slugInput.dataset.autoGenerated === 'true') {
        slugInput.value = this.value.toLowerCase()
            .replace(/[^a-z0-9]+/g, '-')
            .replace(/^-+|-+$/g, '');
        slugInput.dataset.autoGenerated = 'true';
    }
});

// Update slug when manually edited
document.getElementById('slug').addEventListener('input', function() {
    this.dataset.autoGenerated = 'false';
});

// Character counters
document.getElementById('meta_title').addEventListener('input', function() {
    document.getElementById('metaTitleCount').textContent = this.value.length;
});

document.getElementById('meta_description').addEventListener('input', function() {
    document.getElementById('metaDescCount').textContent = this.value.length;
});

// Initialize TinyMCE (will be configured in P3.1.5)
tinymce.init({
    selector: '#content',
    height: 500,
    menubar: false,
    plugins: [
        'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
        'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',
        'insertdatetime', 'media', 'table', 'code', 'help', 'wordcount'
    ],
    toolbar: 'undo redo | formatselect | ' +
        'bold italic backcolor | alignleft aligncenter ' +
        'alignright alignjustify | bullist numlist outdent indent | ' +
        'removeformat | help',
    content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }'
});
</script>
@endpush
@endsection
```

### 5.3 Validation
- Visit `/admin/pages/create` and verify form displays
- Test auto-slug generation from title
- Test form validation
- Verify WYSIWYG editor loads (will be fully configured in P3.1.5)

## 6. Task P3.1.3: Build Page Edit Form

### 6.1 Overview
Create an edit form similar to the create form but pre-populated with existing page data.

### 6.2 Step-by-Step Implementation

#### Step 1: Create Page Edit View

**File: `resources/views/admin/pages/edit.blade.php`**

```blade
@extends('layouts.admin')

@section('title', 'Edit Page')

@section('content')
<div class="max-w-4xl mx-auto">
    <div class="mb-6">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-900">Edit Page</h1>
                <p class="mt-1 text-sm text-gray-600">{{ $page->title }}</p>
            </div>
            <div class="flex items-center gap-3">
                <a 
                    href="{{ route('admin.pages.preview', $page->id) }}" 
                    target="_blank"
                    class="btn btn-outline"
                >
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                    </svg>
                    Preview
                </a>
            </div>
        </div>
    </div>

    <form method="POST" action="{{ route('admin.pages.update', $page->id) }}" id="pageForm">
        @csrf
        @method('PUT')

        <div class="bg-white rounded-lg shadow space-y-6 p-6">
            {{-- Basic Information --}}
            <div>
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Basic Information</h2>
                
                <div class="space-y-4">
                    <div>
                        <label for="title" class="form-label">Title <span class="text-red-500">*</span></label>
                        <input 
                            type="text" 
                            id="title" 
                            name="title" 
                            value="{{ old('title', $page->title) }}"
                            required
                            class="form-input @error('title') border-red-500 @enderror"
                            placeholder="Enter page title"
                        >
                        @error('title')
                            <p class="form-error">{{ $message }}</p>
                        @enderror
                    </div>

                    <div>
                        <label for="slug" class="form-label">URL Slug</label>
                        <div class="flex items-center">
                            <span class="inline-flex items-center px-3 rounded-l-md border border-r-0 border-gray-300 bg-gray-50 text-gray-500 text-sm">
                                /
                            </span>
                            <input 
                                type="text" 
                                id="slug" 
                                name="slug" 
                                value="{{ old('slug', $page->slug) }}"
                                class="form-input rounded-l-none @error('slug') border-red-500 @enderror"
                                placeholder="url-slug"
                            >
                        </div>
                        <p class="mt-1 text-sm text-gray-500">Leave empty to auto-generate from title</p>
                        @error('slug')
                            <p class="form-error">{{ $message }}</p>
                        @enderror
                    </div>

                    <div>
                        <label for="excerpt" class="form-label">Excerpt</label>
                        <textarea 
                            id="excerpt" 
                            name="excerpt" 
                            rows="3"
                            class="form-input @error('excerpt') border-red-500 @enderror"
                            placeholder="Brief description of the page"
                        >{{ old('excerpt', $page->excerpt) }}</textarea>
                        <p class="mt-1 text-sm text-gray-500">A short summary of the page content</p>
                        @error('excerpt')
                            <p class="form-error">{{ $message }}</p>
                        @enderror
                    </div>
                </div>
            </div>

            {{-- Content --}}
            <div>
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Content</h2>
                <div>
                    <label for="content" class="form-label">Content <span class="text-red-500">*</span></label>
                    <textarea 
                        id="content" 
                        name="content" 
                        required
                        class="form-input @error('content') border-red-500 @enderror"
                        rows="15"
                    >{{ old('content', $page->content) }}</textarea>
                    @error('content')
                        <p class="form-error">{{ $message }}</p>
                    @enderror
                </div>
            </div>

            {{-- SEO Settings --}}
            <div>
                <h2 class="text-lg font-semibold text-gray-900 mb-4">SEO Settings</h2>
                <div class="space-y-4">
                    <div>
                        <label for="meta_title" class="form-label">Meta Title</label>
                        <input 
                            type="text" 
                            id="meta_title" 
                            name="meta_title" 
                            value="{{ old('meta_title', $page->meta_title) }}"
                            maxlength="255"
                            class="form-input @error('meta_title') border-red-500 @enderror"
                            placeholder="SEO title (recommended: 50-60 characters)"
                        >
                        <p class="mt-1 text-sm text-gray-500">
                            <span id="metaTitleCount">{{ strlen(old('meta_title', $page->meta_title ?? '')) }}</span>/255 characters
                        </p>
                        @error('meta_title')
                            <p class="form-error">{{ $message }}</p>
                        @enderror
                    </div>

                    <div>
                        <label for="meta_description" class="form-label">Meta Description</label>
                        <textarea 
                            id="meta_description" 
                            name="meta_description" 
                            rows="3"
                            maxlength="500"
                            class="form-input @error('meta_description') border-red-500 @enderror"
                            placeholder="SEO description (recommended: 150-160 characters)"
                        >{{ old('meta_description', $page->meta_description) }}</textarea>
                        <p class="mt-1 text-sm text-gray-500">
                            <span id="metaDescCount">{{ strlen(old('meta_description', $page->meta_description ?? '')) }}</span>/500 characters
                        </p>
                        @error('meta_description')
                            <p class="form-error">{{ $message }}</p>
                        @enderror
                    </div>

                    <div>
                        <label for="meta_keywords" class="form-label">Meta Keywords</label>
                        <input 
                            type="text" 
                            id="meta_keywords" 
                            name="meta_keywords" 
                            value="{{ old('meta_keywords', $page->meta_keywords) }}"
                            class="form-input @error('meta_keywords') border-red-500 @enderror"
                            placeholder="keyword1, keyword2, keyword3"
                        >
                        <p class="mt-1 text-sm text-gray-500">Comma-separated keywords</p>
                        @error('meta_keywords')
                            <p class="form-error">{{ $message }}</p>
                        @enderror
                    </div>
                </div>
            </div>

            {{-- Publishing Options --}}
            <div>
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Publishing Options</h2>
                <div class="space-y-4">
                    <div class="flex items-center">
                        <input 
                            type="checkbox" 
                            id="is_published" 
                            name="is_published" 
                            value="1"
                            {{ old('is_published', $page->is_published) ? 'checked' : '' }}
                            class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"
                        >
                        <label for="is_published" class="ml-2 block text-sm text-gray-900">
                            Publish this page
                        </label>
                    </div>
                </div>
            </div>
        </div>

        {{-- Form Actions --}}
        <div class="mt-6 flex items-center justify-end gap-3">
            <a href="{{ route('admin.pages.index') }}" class="btn btn-outline">
                Cancel
            </a>
            <button type="submit" class="btn btn-primary">
                Update Page
            </button>
        </div>
    </form>
</div>

@push('styles')
<link rel="stylesheet" href="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.css" referrerpolicy="origin">
@endpush

@push('scripts')
<script src="https://cdn.tiny.cloud/1/YOUR_API_KEY/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
<script>
// Character counters
document.getElementById('meta_title').addEventListener('input', function() {
    document.getElementById('metaTitleCount').textContent = this.value.length;
});

document.getElementById('meta_description').addEventListener('input', function() {
    document.getElementById('metaDescCount').textContent = this.value.length;
});

// Initialize TinyMCE (will be configured in P3.1.5)
tinymce.init({
    selector: '#content',
    height: 500,
    menubar: false,
    plugins: [
        'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
        'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',
        'insertdatetime', 'media', 'table', 'code', 'help', 'wordcount'
    ],
    toolbar: 'undo redo | formatselect | ' +
        'bold italic backcolor | alignleft aligncenter ' +
        'alignright alignjustify | bullist numlist outdent indent | ' +
        'removeformat | help',
    content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }'
});
</script>
@endpush
@endsection
```

### 6.3 Validation
- Visit `/admin/pages/{id}/edit` and verify form is pre-populated
- Test updating page data
- Verify validation works
- Test preview button (will be implemented in P3.1.6)

## 7. Task P3.1.4: Implement Page Deletion

### 7.1 Overview
The deletion functionality is already implemented in the controller. We need to ensure proper confirmation and handle soft deletes.

### 7.2 Step-by-Step Implementation

#### Step 1: Verify Controller Method

The `destroy` method in `AdminPageController` is already implemented. Verify it uses soft delete:

**File: `app/Http/Controllers/Admin/AdminPageController.php`** (verify existing implementation)

The delete confirmation modal is already included in the index view (P3.1.1).

#### Step 2: Add Restore Functionality (Optional Enhancement)

**File: `app/Http/Controllers/Admin/AdminPageController.php`** (add method)

```php
/**
 * Restore a soft-deleted page
 *
 * @param int $id
 * @return \Illuminate\Http\RedirectResponse
 */
public function restore(int $id)
{
    try {
        $page = Page::withTrashed()->findOrFail($id);
        $page->restore();

        return redirect()->route('admin.pages.index')
            ->with('success', 'Page restored successfully.');
    } catch (\Exception $e) {
        return redirect()->back()
            ->withErrors(['error' => 'Failed to restore page: ' . $e->getMessage()]);
    }
}
```

#### Step 3: Add Force Delete Method (Optional)

```php
/**
 * Permanently delete a page
 *
 * @param int $id
 * @return \Illuminate\Http\RedirectResponse
 */
public function forceDelete(int $id)
{
    try {
        $page = Page::withTrashed()->findOrFail($id);
        $page->forceDelete();

        return redirect()->route('admin.pages.index')
            ->with('success', 'Page permanently deleted.');
    } catch (\Exception $e) {
        return redirect()->back()
            ->withErrors(['error' => 'Failed to delete page: ' . $e->getMessage()]);
    }
}
```

### 7.3 Update Routes

**File: `routes/admin.php`** (add routes if implementing restore/force delete)

```php
Route::post('/pages/{id}/restore', [AdminPageController::class, 'restore'])->name('pages.restore');
Route::delete('/pages/{id}/force', [AdminPageController::class, 'forceDelete'])->name('pages.force-delete');
```

### 7.4 Validation
- Test delete confirmation modal
- Verify soft delete works
- Check that deleted pages don't appear in normal listing
- Test restore if implemented

## 8. Task P3.1.5: Add WYSIWYG Editor

### 8.1 Overview
Integrate TinyMCE WYSIWYG editor for rich text editing in the page content field.

### 8.2 Step-by-Step Implementation

#### Step 1: Get TinyMCE API Key

1. Sign up at https://www.tiny.cloud/
2. Get your API key
3. Add to `.env`:

```env
TINYMCE_API_KEY=your_api_key_here
```

#### Step 2: Create TinyMCE Configuration File

**File: `resources/js/tinymce-config.js`**

```javascript
export function initTinyMCE(selector, options = {}) {
    const defaultOptions = {
        selector: selector,
        height: 500,
        menubar: false,
        plugins: [
            'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
            'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',
            'insertdatetime', 'media', 'table', 'code', 'help', 'wordcount'
        ],
        toolbar: 'undo redo | formatselect | ' +
            'bold italic backcolor | alignleft aligncenter ' +
            'alignright alignjustify | bullist numlist outdent indent | ' +
            'removeformat | link image | code | help',
        content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }',
        branding: false,
        promotion: false,
        file_picker_types: 'image',
        images_upload_url: '/admin/media/upload',
        automatic_uploads: true,
        relative_urls: false,
        remove_script_host: false,
        convert_urls: true,
        ...options
    };

    return tinymce.init(defaultOptions);
}
```

#### Step 3: Update Create and Edit Views

Update both `create.blade.php` and `edit.blade.php` to use the configuration:

**File: `resources/views/admin/pages/create.blade.php`** (update scripts section)

```blade
@push('scripts')
<script src="https://cdn.tiny.cloud/1/{{ config('services.tinymce.api_key') }}/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    tinymce.init({
        selector: '#content',
        height: 500,
        menubar: false,
        plugins: [
            'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
            'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',
            'insertdatetime', 'media', 'table', 'code', 'help', 'wordcount'
        ],
        toolbar: 'undo redo | formatselect | ' +
            'bold italic backcolor | alignleft aligncenter ' +
            'alignright alignjustify | bullist numlist outdent indent | ' +
            'removeformat | link image | code | help',
        content_style: 'body { font-family:Helvetica,Arial,sans-serif; font-size:14px }',
        branding: false,
        promotion: false,
        file_picker_types: 'image',
        images_upload_url: '{{ route("admin.media.upload") }}',
        automatic_uploads: true,
        relative_urls: false,
        remove_script_host: false,
        convert_urls: true,
        setup: function(editor) {
            editor.on('change', function() {
                editor.save();
            });
        }
    });

    // Auto-generate slug from title
    document.getElementById('title').addEventListener('input', function() {
        const slugInput = document.getElementById('slug');
        if (!slugInput.value || slugInput.dataset.autoGenerated === 'true') {
            slugInput.value = this.value.toLowerCase()
                .replace(/[^a-z0-9]+/g, '-')
                .replace(/^-+|-+$/g, '');
            slugInput.dataset.autoGenerated = 'true';
        }
    });

    document.getElementById('slug').addEventListener('input', function() {
        this.dataset.autoGenerated = 'false';
    });

    // Character counters
    document.getElementById('meta_title').addEventListener('input', function() {
        document.getElementById('metaTitleCount').textContent = this.value.length;
    });

    document.getElementById('meta_description').addEventListener('input', function() {
        document.getElementById('metaDescCount').textContent = this.value.length;
    });
});
</script>
@endpush
```

#### Step 4: Add TinyMCE Config to Services Config

**File: `config/services.php`** (add)

```php
'tinymce' => [
    'api_key' => env('TINYMCE_API_KEY', ''),
],
```

### 8.3 Validation
- Verify TinyMCE editor loads in create form
- Verify TinyMCE editor loads in edit form
- Test all toolbar buttons
- Test image upload (requires media library - P3.3)
- Verify content saves correctly

## 9. Task P3.1.6: Implement Page Preview

### 9.1 Overview
Add functionality to preview pages before publishing, showing how they will appear on the frontend.

### 9.2 Step-by-Step Implementation

#### Step 1: Add Preview Method to Controller

**File: `app/Http/Controllers/Admin/AdminPageController.php`** (add method)

```php
/**
 * Preview a page (even if unpublished)
 *
 * @param int $id
 * @return \Illuminate\View\View
 */
public function preview(int $id)
{
    $page = $this->pageService->getById($id);

    if (!$page) {
        abort(404);
    }

    // Get SEO data for preview
    $seo = $this->seoService->getPageMeta($page);

    return view('web.pages.show', compact('page', 'seo'));
}
```

#### Step 2: Add Preview Route

**File: `routes/admin.php`** (add route)

```php
Route::get('/pages/{id}/preview', [AdminPageController::class, 'preview'])->name('pages.preview');
```

#### Step 3: Create Public Page View (if not exists)

**File: `resources/views/web/pages/show.blade.php`**

```blade
@extends('layouts.app')

@section('content')
<article class="container-custom section-padding">
    <header class="mb-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-4">{{ $page->title }}</h1>
        @if($page->excerpt)
        <p class="text-xl text-gray-600">{{ $page->excerpt }}</p>
        @endif
    </header>

    <div class="prose prose-lg max-w-none">
        {!! $page->content !!}
    </div>
</article>
@endsection
```

### 9.3 Validation
- Click preview button in edit form
- Verify page renders correctly
- Check that unpublished pages can be previewed
- Verify SEO meta tags are included

## 10. Testing and Validation

### 10.1 Complete Workflow Test

1. **Create Page:**
   - Navigate to `/admin/pages/create`
   - Fill in all fields
   - Use WYSIWYG editor
   - Submit form
   - Verify page appears in list

2. **Edit Page:**
   - Click edit on a page
   - Modify content
   - Use WYSIWYG editor
   - Save changes
   - Verify changes are reflected

3. **Preview Page:**
   - Click preview button
   - Verify page renders correctly
   - Check meta tags

4. **Delete Page:**
   - Click delete button
   - Confirm deletion
   - Verify page is removed from list

### 10.2 Common Issues and Solutions

#### Issue: TinyMCE not loading
**Solution:**
- Verify API key is set in `.env`
- Check browser console for errors
- Ensure CDN URL is correct
- Verify referrerpolicy attribute

#### Issue: Content not saving
**Solution:**
- Ensure TinyMCE `editor.save()` is called before form submit
- Check CSRF token is present
- Verify form validation rules
- Check server logs for errors

#### Issue: Slug conflicts
**Solution:**
- Verify `generateUniqueSlug` method in PageService
- Check database for existing slugs
- Ensure soft deletes are considered

#### Issue: Preview not working
**Solution:**
- Verify preview route is registered
- Check that page view exists
- Ensure SEO service is working
- Verify authentication allows preview

## 11. References

### 11.1 Architecture Documents
- Admin Panel Architecture: `documentation/01-architecture/09-admin-panel-architecture.md`
- Laravel MVC Architecture: `documentation/01-architecture/02-laravel-mvc-architecture.md`
- Frontend Architecture: `documentation/01-architecture/04-frontend-architecture.md`

### 11.2 External Resources
- [TinyMCE Documentation](https://www.tiny.cloud/docs/)
- [Laravel Validation](https://laravel.com/docs/10.x/validation)
- [Laravel Blade Templates](https://laravel.com/docs/10.x/blade)

### 11.3 Related Tasks
- **Previous Phase**: P2.3.6 - AdminPageController
- **Next Task**: P3.2 - Blog Management
- **Dependencies**: P2.1.1, P2.2.1, P1.2.3, P2.5.2

---

**Document Version**: 1.0  
**Last Updated**: 2025  
**Status**: Ready for Implementation
