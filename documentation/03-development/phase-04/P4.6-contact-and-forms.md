# P4.6 Contact and Forms Implementation Plan

## 1. Overview and Objectives

### 1.1 Purpose
This document provides detailed step-by-step instructions for implementing the contact page, contact form, and Calendly booking calendar integration.

### 1.2 Scope
This implementation plan covers tasks P4.6.1 through P4.6.4:
- **P4.6.1**: Build contact page
- **P4.6.2**: Build contact form
- **P4.6.3**: Integrate Calendly widget
- **P4.6.4**: Build booking calendar page

### 1.3 Success Criteria
- Contact page displays correctly
- Contact form submits successfully
- Email notifications sent
- Calendly widget integrated
- Booking calendar page functional
- Responsive design works

## 2. Prerequisites

### 2.1 Dependencies
- Task P2.3.4 completed (ContactController created)
- Task P2.1.3 completed (FormService created)
- Task P2.1.5 completed (EmailService created)
- Calendly account and embed URL

### 2.2 Reference Documents
- Frontend Architecture: `documentation/01-architecture/04-frontend-architecture.md`

## 3. Task P4.6.1: Build Contact Page

### 3.1 Step-by-Step Implementation

**File: `resources/views/pages/contact.blade.php`**

```blade
@extends('layouts.app')

@section('title', 'Contact Us - The Strengths Toolbox')

@push('meta')
    <meta name="description" content="Get in touch with The Strengths Toolbox. Book a consultation, ask questions, or learn more about our strengths-based development programs.">
    <meta property="og:title" content="Contact Us - The Strengths Toolbox">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ url('/contact') }}">
@endpush

@section('content')
    <!-- Hero Section -->
    <section class="bg-gradient-to-br from-primary-600 to-primary-800 text-white py-16">
        <div class="container-custom">
            <div class="max-w-4xl mx-auto text-center">
                <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-4">
                    Get In Touch
                </h1>
                <p class="text-xl text-primary-100">
                    Ready to transform your team? Let's start the conversation.
                </p>
            </div>
        </div>
    </section>

    <!-- Contact Information -->
    <section class="section-padding bg-white">
        <div class="container-custom">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
                <!-- Email -->
                <div class="text-center">
                    <div class="w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Email</h3>
                    <a href="mailto:{{ config('mail.from.address') }}" class="text-primary-600 hover:text-primary-700">
                        {{ config('mail.from.address') }}
                    </a>
                </div>

                <!-- Phone -->
                <div class="text-center">
                    <div class="w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Phone</h3>
                    <a href="tel:{{ config('app.phone', '+27 XX XXX XXXX') }}" class="text-primary-600 hover:text-primary-700">
                        {{ config('app.phone', '+27 XX XXX XXXX') }}
                    </a>
                </div>

                <!-- Location -->
                <div class="text-center">
                    <div class="w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Location</h3>
                    <p class="text-gray-600">South Africa</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Form Section -->
    <section class="section-padding bg-gray-50">
        <div class="container-custom">
            <div class="max-w-3xl mx-auto">
                <div class="text-center mb-8">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
                        Send Us a Message
                    </h2>
                    <p class="text-lg text-gray-600">
                        Have a question? We'd love to hear from you.
                    </p>
                </div>

                @include('partials.contact.form')
            </div>
        </div>
    </section>

    <!-- CTA Section -->
    <section class="section-padding bg-primary-600 text-white">
        <div class="container-custom">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="text-3xl md:text-4xl font-bold mb-4">
                    Ready to Get Started?
                </h2>
                <p class="text-xl text-primary-100 mb-8">
                    Book your complimentary 30-minute consultation today
                </p>
                <a href="{{ route('booking') }}" class="btn btn-secondary text-lg px-8 py-4">
                    Book Your Free Consultation
                </a>
            </div>
        </div>
    </section>
@endsection
```

## 4. Task P4.6.2: Build Contact Form

### 4.1 Step-by-Step Implementation

**File: `resources/views/partials/contact/form.blade.php`**

```blade
<form 
    action="{{ route('contact.submit') }}" 
    method="POST"
    x-data="{ 
        submitting: false,
        success: false,
        errors: {}
    }"
    @submit.prevent="
        submitting = true;
        errors = {};
        
        fetch('{{ route('contact.submit') }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': document.querySelector('meta[name=csrf-token]').content,
                'Accept': 'application/json'
            },
            body: JSON.stringify({
                name: $refs.name.value,
                email: $refs.email.value,
                phone: $refs.phone.value,
                subject: $refs.subject.value,
                message: $refs.message.value
            })
        })
        .then(response => response.json())
        .then(data => {
            submitting = false;
            if (data.errors) {
                errors = data.errors;
            } else if (data.success || data.message) {
                success = true;
                $refs.name.value = '';
                $refs.email.value = '';
                $refs.phone.value = '';
                $refs.subject.value = '';
                $refs.message.value = '';
                setTimeout(() => { success = false; }, 5000);
            }
        })
        .catch(() => {
            submitting = false;
            errors = { error: ['Something went wrong. Please try again.'] };
        })
    "
    class="bg-white rounded-xl p-8 shadow-lg"
>
    @csrf

    <!-- Success Message -->
    <div x-show="success" x-transition class="mb-6 p-4 bg-green-50 border border-green-200 rounded-lg">
        <p class="text-green-800 font-semibold">
            Thank you! Your message has been sent. We'll get back to you soon.
        </p>
    </div>

    <!-- Error Messages -->
    <div x-show="Object.keys(errors).length > 0" x-transition class="mb-6">
        <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
            <ul class="list-disc list-inside text-red-800 text-sm">
                <template x-for="(errorList, field) in errors" :key="field">
                    <template x-for="error in errorList" :key="error">
                        <li x-text="error"></li>
                    </template>
                </template>
            </ul>
        </div>
    </div>

    <!-- Name Field -->
    <div class="mb-6">
        <label for="name" class="block text-sm font-semibold text-gray-700 mb-2">
            Full Name <span class="text-red-500">*</span>
        </label>
        <input 
            type="text" 
            id="name" 
            name="name"
            x-ref="name"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
            placeholder="Enter your full name"
        >
    </div>

    <!-- Email Field -->
    <div class="mb-6">
        <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">
            Email Address <span class="text-red-500">*</span>
        </label>
        <input 
            type="email" 
            id="email" 
            name="email"
            x-ref="email"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
            placeholder="Enter your email address"
        >
    </div>

    <!-- Phone Field -->
    <div class="mb-6">
        <label for="phone" class="block text-sm font-semibold text-gray-700 mb-2">
            Phone Number
        </label>
        <input 
            type="tel" 
            id="phone" 
            name="phone"
            x-ref="phone"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
            placeholder="Enter your phone number (optional)"
        >
    </div>

    <!-- Subject Field -->
    <div class="mb-6">
        <label for="subject" class="block text-sm font-semibold text-gray-700 mb-2">
            Subject <span class="text-red-500">*</span>
        </label>
        <input 
            type="text" 
            id="subject" 
            name="subject"
            x-ref="subject"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
            placeholder="What is this regarding?"
        >
    </div>

    <!-- Message Field -->
    <div class="mb-6">
        <label for="message" class="block text-sm font-semibold text-gray-700 mb-2">
            Message <span class="text-red-500">*</span>
        </label>
        <textarea 
            id="message" 
            name="message"
            x-ref="message"
            rows="6"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"
            placeholder="Tell us how we can help..."
        ></textarea>
        <p class="text-sm text-gray-500 mt-2">Minimum 10 characters</p>
    </div>

    <!-- Submit Button -->
    <button 
        type="submit"
        :disabled="submitting"
        class="w-full btn btn-primary text-lg py-4"
        :class="{ 'opacity-50 cursor-not-allowed': submitting }"
    >
        <span x-show="!submitting">Send Message</span>
        <span x-show="submitting">Sending...</span>
    </button>

    <p class="text-xs text-gray-500 mt-4 text-center">
        By submitting this form, you agree to our privacy policy.
    </p>
</form>
```

### 4.2 Update ContactController

**File: `app/Http/Controllers/Web/ContactController.php`** (verify/update)

```php
public function submit(Request $request)
{
    $validated = $request->validate([
        'name' => 'required|string|max:255',
        'email' => 'required|email|max:255',
        'phone' => 'nullable|string|max:20',
        'subject' => 'required|string|max:255',
        'message' => 'required|string|min:10',
    ]);

    try {
        // Get or create contact form
        $form = $this->formService->getBySlug('contact');
        
        if (!$form) {
            $form = $this->formService->create([
                'name' => 'Contact Form',
                'slug' => 'contact',
                'email_to' => config('mail.contact_to', config('mail.from.address')),
                'is_active' => true,
                'fields' => json_encode([
                    ['name' => 'name', 'type' => 'text', 'required' => true, 'label' => 'Full Name'],
                    ['name' => 'email', 'type' => 'email', 'required' => true, 'label' => 'Email Address'],
                    ['name' => 'phone', 'type' => 'tel', 'required' => false, 'label' => 'Phone Number'],
                    ['name' => 'subject', 'type' => 'text', 'required' => true, 'label' => 'Subject'],
                    ['name' => 'message', 'type' => 'textarea', 'required' => true, 'label' => 'Message'],
                ]),
            ]);
        }

        // Submit form
        $this->formService->submit($form->id, $validated);

        if ($request->expectsJson()) {
            return response()->json([
                'success' => true,
                'message' => 'Thank you! Your message has been sent. We\'ll get back to you soon.'
            ]);
        }

        return redirect()->back()->with('success', 'Thank you! Your message has been sent.');
    } catch (\Exception $e) {
        if ($request->expectsJson()) {
            return response()->json([
                'errors' => ['error' => ['Something went wrong. Please try again.']]
            ], 422);
        }

        return redirect()->back()
            ->withInput()
            ->withErrors(['error' => 'Something went wrong. Please try again.']);
    }
}
```

## 5. Task P4.6.3: Integrate Calendly Widget

### 5.1 Step-by-Step Implementation

#### Step 1: Add Calendly Script to Layout

**File: `resources/views/layouts/app.blade.php`** (add before closing body tag)

```blade
@if(config('services.calendly.enabled', false))
    <script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>
@endif
```

#### Step 2: Create Calendly Widget Component

**File: `resources/views/components/calendly-widget.blade.php`**

```blade
@props(['url', 'height' => '700px'])

@php
    $calendlyUrl = $url ?? config('services.calendly.url');
@endphp

@if($calendlyUrl)
    <div 
        class="calendly-inline-widget" 
        data-url="{{ $calendlyUrl }}"
        style="min-width:320px;height:{{ $height }};"
    ></div>
@else
    <div class="bg-gray-100 rounded-lg p-8 text-center">
        <p class="text-gray-600">Calendly widget not configured.</p>
    </div>
@endif
```

#### Step 3: Add Calendly Config

**File: `config/services.php`** (add to array)

```php
'calendly' => [
    'enabled' => env('CALENDLY_ENABLED', false),
    'url' => env('CALENDLY_URL', ''),
],
```

#### Step 4: Update Contact Page to Include Widget

Add to contact page or create separate section:

```blade
<!-- Calendly Section -->
<section class="section-padding bg-white">
    <div class="container-custom">
        <div class="max-w-4xl mx-auto">
            <div class="text-center mb-8">
                <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">
                    Book Your Free Consultation
                </h2>
                <p class="text-lg text-gray-600">
                    Schedule a 30-minute complimentary consultation
                </p>
            </div>
            <x-calendly-widget :url="config('services.calendly.url')" />
        </div>
    </div>
</section>
```

## 6. Task P4.6.4: Build Booking Calendar Page

### 6.1 Step-by-Step Implementation

**File: `resources/views/pages/booking.blade.php`**

```blade
@extends('layouts.app')

@section('title', 'Book a Consultation - The Strengths Toolbox')

@push('meta')
    <meta name="description" content="Book your complimentary 30-minute consultation with The Strengths Toolbox. Schedule a time that works for you.">
    <meta property="og:title" content="Book a Consultation - The Strengths Toolbox">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ url('/booking') }}">
@endpush

@section('content')
    <!-- Hero Section -->
    <section class="bg-gradient-to-br from-primary-600 to-primary-800 text-white py-16">
        <div class="container-custom">
            <div class="max-w-4xl mx-auto text-center">
                <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold mb-4">
                    Book Your Free Consultation
                </h1>
                <p class="text-xl text-primary-100">
                    Schedule a 30-minute complimentary consultation to discuss how 
                    strengths-based development can transform your business.
                </p>
            </div>
        </div>
    </section>

    <!-- Benefits Section -->
    <section class="section-padding bg-white">
        <div class="container-custom">
            <div class="max-w-3xl mx-auto mb-12">
                <h2 class="text-3xl font-bold text-gray-900 mb-6 text-center">
                    What to Expect
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    @php
                        $benefits = [
                            [
                                'title' => 'No Obligation',
                                'description' => 'This is a free consultation with no commitment required.'
                            ],
                            [
                                'title' => 'Personalized Discussion',
                                'description' => 'We'll discuss your specific challenges and goals.'
                            ],
                            [
                                'title' => 'Expert Insights',
                                'description' => 'Get insights from 30+ years of experience.'
                            ],
                            [
                                'title' => 'Clear Next Steps',
                                'description' => 'Leave with a clear understanding of how we can help.'
                            ]
                        ];
                    @endphp

                    @foreach($benefits as $benefit)
                        <div class="flex gap-4">
                            <div class="flex-shrink-0">
                                <div class="w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-primary-600" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                            </div>
                            <div>
                                <h3 class="font-bold text-gray-900 mb-1">{{ $benefit['title'] }}</h3>
                                <p class="text-gray-600">{{ $benefit['description'] }}</p>
                            </div>
                        </div>
                    @endforeach
                </div>
            </div>
        </div>
    </section>

    <!-- Calendly Widget -->
    <section class="section-padding bg-gray-50">
        <div class="container-custom">
            <div class="max-w-5xl mx-auto">
                <x-calendly-widget :url="config('services.calendly.url')" height="800px" />
            </div>
        </div>
    </section>

    <!-- Alternative Contact -->
    <section class="section-padding bg-white">
        <div class="container-custom">
            <div class="max-w-3xl mx-auto text-center">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">
                    Prefer to Contact Us Directly?
                </h2>
                <p class="text-gray-600 mb-6">
                    If you'd rather reach out via email or phone, we're here to help.
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <a href="mailto:{{ config('mail.from.address') }}" class="btn btn-outline">
                        Send Email
                    </a>
                    <a href="{{ route('contact') }}" class="btn btn-primary">
                        Contact Form
                    </a>
                </div>
            </div>
        </div>
    </section>
@endsection
```

#### Step 2: Add Route

**File: `routes/web.php`**

```php
Route::get('/booking', function() {
    return view('pages.booking');
})->name('booking');
```

## 7. Create Partials Directory

```bash
mkdir -p resources/views/partials/contact
```

## 8. Validation Checklist

- [ ] Contact page displays correctly
- [ ] Contact form submits successfully
- [ ] Email notifications sent
- [ ] Form validation works (client and server)
- [ ] Success/error messages display
- [ ] Calendly widget loads
- [ ] Booking calendar page functional
- [ ] All links work correctly
- [ ] Responsive design works

## 9. Environment Variables

Add to `.env`:

```env
CALENDLY_ENABLED=true
CALENDLY_URL=https://calendly.com/your-username/consultation
MAIL_CONTACT_TO=contact@thestrengthstoolbox.com
```

## 10. References

- Frontend Architecture: `documentation/01-architecture/04-frontend-architecture.md`
- **Next Task**: P4.7 - Responsive Design Implementation Plan

---

**Document Version**: 1.0  
**Last Updated**: 2025  
**Status**: Ready for Implementation
