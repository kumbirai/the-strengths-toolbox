# P8.3.5 Form Validation System Test Plan

## 1. Overview and Objectives

### 1.1 Purpose
This document provides detailed step-by-step instructions for system testing form validation. These tests verify that both client-side and server-side validation work correctly.

### 1.2 Scope
This implementation plan covers task P8.3.5:
- **P8.3.5**: Test form validation
  - Test client-side validation
  - Test server-side validation
  - Test required field validation
  - Test email validation
  - Test field length validation
  - Test custom validation rules

### 1.3 Success Criteria
- All form validations tested
- Client-side validation works
- Server-side validation works
- Error messages display correctly
- All tests pass consistently

## 2. Prerequisites

### 2.1 Required Knowledge
- Form validation
- Client-side validation
- Server-side validation
- Laravel validation rules

### 2.2 Dependencies
- Task P4.6.2 completed (Form validation implemented)
- Forms created
- Validation rules defined

### 2.3 Reference Documents
- Testing Strategy: `documentation/02-project-management/06-testing-strategy.md`
- Existing tests: `tests/Feature/ContactFormTest.php`

## 3. Existing Implementation Review

### 3.1 Current State
The following form validation tests exist:
- `ContactFormTest.php` - Basic contact form validation
- `EbookFormTest.php` - Basic eBook form validation

### 3.2 What Needs to Be Done
- Enhance existing validation tests
- Test all validation rules
- Test error message display
- Test client-side validation
- Test server-side validation

## 4. Task P8.3.5: Test Form Validation

### 4.1 Overview
Create comprehensive form validation tests by:
1. Testing required field validation
2. Testing email validation
3. Testing length validation
4. Testing custom validation
5. Testing error messages

### 4.2 Test Structure

Form validation tests should follow this structure:
```php
<?php

namespace Tests\Feature;

use Tests\TestCase;
use Illuminate\Foundation\Testing\RefreshDatabase;

class FormValidationTest extends TestCase
{
    use RefreshDatabase;

    // Test methods
}
```

### 4.3 Step-by-Step Implementation

#### Step 1: Enhance Contact Form Validation Tests

**File: `tests/Feature/ContactFormTest.php`** (enhance existing)

**Additional Test Coverage:**
- All validation rules
- Error message display
- Client-side validation
- Server-side validation

**Key Test Cases to Add:**
```php
public function test_contact_form_validates_all_required_fields(): void
{
    $response = $this->postJson('/contact', []);

    $response->assertStatus(422);
    $response->assertJsonValidationErrors(['name', 'email', 'subject', 'message']);
}

public function test_contact_form_validates_email_format(): void
{
    $response = $this->postJson('/contact', [
        'name' => 'Test',
        'email' => 'invalid-email',
        'subject' => 'Test',
        'message' => 'Test message with enough characters.',
    ]);

    $response->assertStatus(422);
    $response->assertJsonValidationErrors(['email']);
}

public function test_contact_form_validates_message_length(): void
{
    $response = $this->postJson('/contact', [
        'name' => 'Test',
        'email' => 'test@example.com',
        'subject' => 'Test',
        'message' => 'Short', // Too short
    ]);

    $response->assertStatus(422);
    $response->assertJsonValidationErrors(['message']);
}

public function test_contact_form_error_messages_display_correctly(): void
{
    $response = $this->post('/contact', []);

    $response->assertSessionHasErrors(['name', 'email', 'subject', 'message']);
}
```

#### Step 2: Create Comprehensive Form Validation Tests

**File: `tests/Feature/FormValidationTest.php`** (new)

**Test Coverage Required:**
- All form types
- All validation rules
- Error message formats
- Validation on different field types

**Key Test Cases:**
```php
public function test_dynamic_form_validates_required_fields(): void
{
    $form = Form::factory()->create([
        'slug' => 'test-form',
        'fields' => json_encode([
            ['name' => 'name', 'type' => 'text', 'required' => true, 'label' => 'Name'],
            ['name' => 'email', 'type' => 'email', 'required' => true, 'label' => 'Email'],
        ]),
    ]);

    $response = $this->postJson(route('forms.submit', $form->slug), []);

    $response->assertStatus(422);
    $response->assertJsonValidationErrors(['name', 'email']);
}

public function test_form_validates_email_format(): void
{
    $form = Form::factory()->create([
        'slug' => 'test-form',
        'fields' => json_encode([
            ['name' => 'email', 'type' => 'email', 'required' => true, 'label' => 'Email'],
        ]),
    ]);

    $response = $this->postJson(route('forms.submit', $form->slug), [
        'email' => 'invalid-email',
    ]);

    $response->assertStatus(422);
    $response->assertJsonValidationErrors(['email']);
}
```

## 5. Test Implementation Guidelines

### 5.1 Validation Testing

**Test Validation Rules:**
```php
$response = $this->postJson('/form', $invalidData);
$response->assertStatus(422);
$response->assertJsonValidationErrors(['field_name']);
```

### 5.2 Error Message Testing

**Test Error Messages:**
```php
$response = $this->post('/form', $invalidData);
$response->assertSessionHasErrors(['field_name']);
```

## 6. Validation Steps

### 6.1 Code Validation

1. **Check all test files exist:**
   ```bash
   find tests/Feature -name "*Validation*Test.php" -o -name "*Form*Test.php"
   ```

### 6.2 Test Execution

1. **Run validation tests:**
   ```bash
   php artisan test tests/Feature --filter Validation
   ```

### 6.3 Functional Validation

1. **Manual Testing:**
   - Submit forms with invalid data
   - Verify error messages
   - Test client-side validation
   - Test server-side validation

## 7. Success Criteria Checklist

- [ ] Contact form validation tests enhanced
- [ ] Dynamic form validation tests created
- [ ] All validation rules tested
- [ ] Error messages tested
- [ ] Client-side validation tested
- [ ] Server-side validation tested
- [ ] All tests pass consistently

## 8. Next Steps

After completing P8.3.5:
- Review all system test coverage
- Address any gaps
- Proceed to P8.4: Performance Testing

## 9. Notes

- Test both client-side and server-side validation
- Verify error messages are user-friendly
- Test all validation rules
- Test edge cases
- Verify validation works on all form types

---

**Document Version:** 1.0  
**Last Updated:** 2025-01-27  
**Status:** Ready for Implementation
